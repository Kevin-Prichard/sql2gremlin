<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL2Gremlin</title>
    
    <link rel="stylesheet" type="text/css" href="http://documentup.com/stylesheets/screen.css">
      <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-42385195-1']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

      </script>
  </head>
  <body><div id="container">
  <div id="nav">
    
      <div id="header">
        <a href="#" id="logo">SQL2Gremlin</a>
      </div>
    
    <ul id="sections">
      
        <li>
          <a href="#introduction">Introduction</a>
          
        </li>
      
        <li>
          <a href="#northwind-graph-model">Northwind Graph Model</a>
          
        </li>
      
        <li>
          <a href="#getting-started">Getting Started</a>
          
        </li>
      
        <li>
          <a href="#select">Select</a>
          
            <ul>
              
                <li>
                  <a href="#select/select-all">Select all</a>
                </li>
              
                <li>
                  <a href="#select/select-single-column">Select single column</a>
                </li>
              
                <li>
                  <a href="#select/select-multiple-columns">Select multiple columns</a>
                </li>
              
                <li>
                  <a href="#select/select-calculated-column">Select calculated column</a>
                </li>
              
                <li>
                  <a href="#select/select-distinct-values">Select distinct values</a>
                </li>
              
                <li>
                  <a href="#select/select-scalar-value">Select scalar value</a>
                </li>
              
            </ul>
          
        </li>
      
        <li>
          <a href="#filtering">Filtering</a>
          
            <ul>
              
                <li>
                  <a href="#filtering/filter-by-equality">Filter by equality</a>
                </li>
              
                <li>
                  <a href="#filtering/filter-by-inequality">Filter by inequality</a>
                </li>
              
                <li>
                  <a href="#filtering/filter-by-value-range">Filter by value range</a>
                </li>
              
                <li>
                  <a href="#filtering/multiple-filter-conditions">Multiple filter conditions</a>
                </li>
              
            </ul>
          
        </li>
      
        <li>
          <a href="#ordering">Ordering</a>
          
            <ul>
              
                <li>
                  <a href="#ordering/order-by-value-ascending">Order by value ascending</a>
                </li>
              
                <li>
                  <a href="#ordering/order-by-value-descending">Order by value descending</a>
                </li>
              
            </ul>
          
        </li>
      
        <li>
          <a href="#paging">Paging</a>
          
            <ul>
              
                <li>
                  <a href="#paging/limit-number-of-results">Limit number of results</a>
                </li>
              
                <li>
                  <a href="#paging/paged-result-set">Paged result set</a>
                </li>
              
            </ul>
          
        </li>
      
        <li>
          <a href="#grouping">Grouping</a>
          
            <ul>
              
                <li>
                  <a href="#grouping/group-by-value">Group by value</a>
                </li>
              
            </ul>
          
        </li>
      
        <li>
          <a href="#joining">Joining</a>
          
            <ul>
              
                <li>
                  <a href="#joining/inner-join">Inner join</a>
                </li>
              
                <li>
                  <a href="#joining/left-join">Left join</a>
                </li>
              
            </ul>
          
        </li>
      
        <li>
          <a href="#miscellaneous">Miscellaneous</a>
          
            <ul>
              
                <li>
                  <a href="#miscellaneous/concatenate">Concatenate</a>
                </li>
              
                <li>
                  <a href="#miscellaneous/create-update-and-delete">Create, Update and Delete</a>
                </li>
              
            </ul>
          
        </li>
      
        <li>
          <a href="#cte">CTE</a>
          
            <ul>
              
                <li>
                  <a href="#cte/recursive-query">Recursive query</a>
                </li>
              
            </ul>
          
        </li>
      
        <li>
          <a href="#complex">Complex</a>
          
            <ul>
              
                <li>
                  <a href="#complex/pivots">Pivots</a>
                </li>
              
                <li>
                  <a href="#complex/recommendation">Recommendation</a>
                </li>
              
            </ul>
          
        </li>
      
    </ul>
    
    
      <div class="extra twitter">
        <iframe allowtransparency="true" frameborder="0" scrolling="no" style="width:162px; height:20px;" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=dkuppitz&show_count=false"></iframe>
      </div>
    
  </div>
  <div id="content">
    
    <h1><img src="http://sql2gremlin.com/assets/sql2gremlin.png" alt="SQL2Gremlin"></h1>
<h2 id='introduction'>Introduction</h2 id='introduction'>
<p>SQL2Gremlin teaches the Gremlin graph traversal language using typical patterns found when querying data with SQL. The format of the Gremlin results will not necessarily match the format of the SQL results. While SQL can only provide results in a tabular form, Gremlin provides various ways to structure a result set. Next, the Gremlin queries demonstrated are for elucidatory purposes and may not be the optimal way to retrieve the desired data. If a particular query runs slow and an optimal solution is desired, please do not hesitate to ask for help on the <a href="https://groups.google.com/forum/#!forum/gremlin-users">Gremlin-users mailing list</a>. Finally, the SQL examples presented make use of T-SQL syntax. MySQL users may not know some of the expressions (e.g. paging), but should be able to understand the purpose of the query. </p>
<p>If you would like to see other SQL2Gremlin translations using the Northwind dataset, please provide a ticket on the <a href="https://github.com/dkuppitz/sql2gremlin/issues">SQL2Gremlin issue tracker</a>.</p>
<p><em>Acknowledgement</em>: Gremlin artwork by <a href="http://ketrinadrawsalot.tumblr.com/">Ketrina Yim</a> -- &quot;safety first.&quot;</p>
<h2 id='northwind-graph-model'>Northwind Graph Model</h2 id='northwind-graph-model'>
<p><img src="http://sql2gremlin.com/assets/model.png" alt="Northwind Graph Model"></p>
<p>You can visually examine the graph by viewing the <a href="http://sql2gremlin.com/graph/">Northwind Graph Visualization</a>.</p>
<h2 id='getting-started'>Getting Started</h2 id='getting-started'>
<p>To get started download the latest Gremlin version from <a href="http://gremlin.tinkerpop.com">gremlin.tinkerpop.com</a> and extract it. Then download the file <a href="http://sql2gremlin.com/assets/northwind.groovy">northwind.groovy</a> and start your Gremlin shell:</p>
<pre><code class="lang-text">LATEST_URL=<span class="variable">$(</span>curl https:<span class="regexp">//github</span>.com/tinkerpop/gremlin/wiki/Downloads | <span class="keyword">grep</span> -o <span class="string">'http://.*.zip'</span> | head -n1)
LATEST_FILENAME=<span class="variable">$(</span>echo <span class="variable">$LATEST_URL</span> | <span class="keyword">grep</span> -Po <span class="string">'(?&lt;=/)[^/]+\.zip$'</span>)
LATEST_DIRECTORY=<span class="variable">$(</span>echo <span class="variable">$LATEST_FILENAME</span> | <span class="keyword">grep</span> -Po <span class="string">'.*(?=\.zip$)'</span>)

wget -<span class="keyword">q</span> <span class="variable">$LATEST_URL</span>
wget -<span class="keyword">q</span> http:<span class="regexp">//sql</span>2gremlin.com/assets/northwind.groovy -O /tmp/northwind.groovy 
unzip -<span class="keyword">q</span> <span class="variable">$LATEST_FILENAME</span>
<span class="variable">$LATEST_DIRECTORY</span>/bin/gremlin.sh /tmp/northwind.groovy</code></pre>
<p>In your Gremlin shell create the Northwind graph and you&#39;re ready to go:</p>
<pre><code class="lang-text">gremlin&gt; g = <span class="class">NorthwindFactory</span>.createGraph()
==&gt;tinkergraph[<span class="method">vertices:</span><span class="number">3209</span> <span class="method">edges:</span><span class="number">6177</span>]</code></pre>
<p>The graph is now filled with vertices and edges. Vertices have a number of properties, depending on what they represent. The following properties are globally indexed for fast lookups:</p>
<table>
  <thead>
    <tr>
      <th>Property</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type</td>
      <td>The type of this vertex.</td>
    </tr>
    <tr>
      <td>region</td>
      <td>The code or name for a specific region.</td>
    </tr>
    <tr>
      <td>country</td>
      <td>The code or name for a specific country.</td>
    </tr>
    <tr>
      <td>customerId</td>
      <td>The well-known Northwind customer identifier (e.g. ALFKI).</td>
    </tr>
    <tr>
      <td>categoryName</td>
      <td>The name of a specific category.</td>
    </tr>
    </tr>
  </tbody>
</table>

<h2 id='select'>Select</h2 id='select'>
<h3 id='select/select-all'>Select all</h3 id='select/select-all'>
<p>This sample shows how to query all categories.</p>
<h4>SQL</h4>
<pre><code class="lang-sql"><span class="operator"><span class="keyword">SELECT</span> *
  <span class="keyword">FROM</span> Categories</code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','category').map<span class="container">()</span></span></code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#transform/map">Gremlin map step</a></li>
</ul>
<h3 id='select/select-single-column'>Select single column</h3 id='select/select-single-column'>
<p>This sample shows how to query the names of all categories.</p>
<h4>SQL</h4>
<pre><code class="lang-sql"><span class="operator"><span class="keyword">SELECT</span> CategoryName
  <span class="keyword">FROM</span> Categories</code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','category').categoryName</span></code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
</ul>
<h3 id='select/select-multiple-columns'>Select multiple columns</h3 id='select/select-multiple-columns'>
<p>This sample shows how to query the names and descriptions of all categories.</p>
<h4>SQL</h4>
<pre><code class="lang-sql"><span class="operator"><span class="keyword">SELECT</span> CategoryName, Description
  <span class="keyword">FROM</span> Categories</code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','category').transform<span class="container">({
  [ '<span class="title">name'</span> : <span class="title">it</span>.<span class="title">getProperty</span>('<span class="title">categoryName'</span>)</span></span>
  ,<span class="string"> 'desc'</span> : it.getProperty('description') ]
})</code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#transform/transform">Gremlin transform step</a></li>
<li><a href="http://gremlindocs.com/#transform/key">Gremlin property access</a></li>
</ul>
<h3 id='select/select-calculated-column'>Select calculated column</h3 id='select/select-calculated-column'>
<p>This sample shows how to query the length of the name of all categories.</p>
<h4>SQL</h4>
<pre><code class="lang-sql"><span class="operator"><span class="keyword">SELECT</span> LENGTH(CategoryName)
  <span class="keyword">FROM</span> Categories</code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','category').categoryName.transform<span class="container">({<span class="title">it</span>.<span class="title">length</span>()</span>})</span></code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#transform/transform">Gremlin transform step</a></li>
<li><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html#length%28%29">Java string length</a></li>
</ul>
<h3 id='select/select-distinct-values'>Select distinct values</h3 id='select/select-distinct-values'>
<p>This sample shows how to query all distinct lengths of category names.</p>
<h4>SQL</h4>
<pre><code class="lang-sql"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> LENGTH(CategoryName)
  <span class="keyword">FROM</span> Categories</code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','category').categoryName.transform<span class="container">({<span class="title">it</span>.<span class="title">length</span>()</span>}).dedup<span class="container">()</span></span></code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#transform/transform">Gremlin transform step</a></li>
<li><a href="http://gremlindocs.com/#filter/dedup">Gremlin dedup step</a></li>
<li><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html#length%28%29">Java string length</a></li>
</ul>
<h3 id='select/select-scalar-value'>Select scalar value</h3 id='select/select-scalar-value'>
<p>This sample shows how to query the length of the longest category name.</p>
<h4>SQL</h4>
<pre><code class="lang-sql"><span class="operator"><span class="keyword">SELECT</span> <span class="aggregate">MAX</span>(LENGTH(CategoryName))
  <span class="keyword">FROM</span> Categories</code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','category').categoryName.transform<span class="container">({<span class="title">it</span>.<span class="title">length</span>()</span>}).max<span class="container">()</span></span></code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#transform/transform">Gremlin transform step</a></li>
<li><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html#length%28%29">Java string length</a></li>
<li><a href="http://groovy.codehaus.org/groovy-jdk/java/util/Collection.html#max%28%29">Groovy max method</a></li>
</ul>
<h2 id='filtering'>Filtering</h2 id='filtering'>
<h3 id='filtering/filter-by-equality'>Filter by equality</h3 id='filtering/filter-by-equality'>
<p>This sample shows how to query all products having no unit in stock.</p>
<h4>SQL</h4>
<pre><code class="lang-sql"><span class="operator"><span class="keyword">SELECT</span> *
  <span class="keyword">FROM</span> Products
 <span class="keyword">WHERE</span> UnitsInStock = <span class="number">0</span></code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','product').has<span class="container">('<span class="title">unitsInStock'</span>, 0)</span>.map<span class="container">()</span></span></code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#filter/has">Gremlin has step</a></li>
<li><a href="http://gremlindocs.com/#transform/map">Gremlin map step</a></li>
</ul>
<h3 id='filtering/filter-by-inequality'>Filter by inequality</h3 id='filtering/filter-by-inequality'>
<p>This sample shows how to query all products with a unit price not exceeding 10.</p>
<h4>SQL</h4>
<pre><code class="lang-sql"><span class="operator"><span class="keyword">SELECT</span> *
  <span class="keyword">FROM</span> Products
 <span class="keyword">WHERE</span> <span class="keyword">NOT</span>(UnitPrice &gt; <span class="number">10</span>)</code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','product').hasNot<span class="container">('<span class="title">unitPrice'</span>, <span class="type">T</span>.<span class="title">gt</span>, 10<span class="title">f</span>)</span>.map<span class="container">()</span></span></code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#filter/hasnot">Gremlin hasNot step</a></li>
<li><a href="http://gremlindocs.com/#transform/map">Gremlin map step</a></li>
</ul>
<h3 id='filtering/filter-by-value-range'>Filter by value range</h3 id='filtering/filter-by-value-range'>
<p>This sample shows how to query all products with a minimum price of 5 and maximum price below 10.</p>
<h4>SQL</h4>
<pre><code class="lang-sql"><span class="operator"><span class="keyword">SELECT</span> *
  <span class="keyword">FROM</span> Products
 <span class="keyword">WHERE</span> UnitPrice &gt;= <span class="number">5</span> <span class="keyword">AND</span> UnitPrice &lt; <span class="number">10</span></code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','product').interval<span class="container">('<span class="title">unitPrice'</span>, 5<span class="title">f</span>, 10<span class="title">f</span>)</span>.map<span class="container">()</span></span></code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#filter/interval">Gremlin interval step</a></li>
<li><a href="http://gremlindocs.com/#transform/map">Gremlin map step</a></li>
</ul>
<h3 id='filtering/multiple-filter-conditions'>Multiple filter conditions</h3 id='filtering/multiple-filter-conditions'>
<p>This sample shows how to query all discontinued products that are still not out of stock.</p>
<h4>SQL</h4>
<pre><code class="lang-sql"><span class="operator"><span class="keyword">SELECT</span> *
  <span class="keyword">FROM</span> Products
 <span class="keyword">WHERE</span> Discontinued = <span class="number">1</span>
   <span class="keyword">AND</span> UnitsInStock &lt;&gt; <span class="number">0</span></code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','product').has<span class="container">('<span class="title">discontinued'</span>, <span class="title">true</span>)</span> \</span>
                     .hasNot('unitsInStock', <span class="number">0</span>).map()</code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#filter/has">Gremlin has step</a></li>
<li><a href="http://gremlindocs.com/#filter/hasnot">Gremlin hasNot step</a></li>
<li><a href="http://gremlindocs.com/#transform/map">Gremlin map step</a></li>
</ul>
<h2 id='ordering'>Ordering</h2 id='ordering'>
<h3 id='ordering/order-by-value-ascending'>Order by value ascending</h3 id='ordering/order-by-value-ascending'>
<p>This sample shows how to query all products ordered by unit price.</p>
<h4>SQL</h4>
<pre><code class="lang-sql">  <span class="operator"><span class="keyword">SELECT</span> *
    <span class="keyword">FROM</span> Products
<span class="keyword">ORDER</span> <span class="keyword">BY</span> UnitPrice <span class="keyword">ASC</span></code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','product').order<span class="container">({
  <span class="title">it</span>.<span class="title">a</span>.<span class="title">getProperty</span>('<span class="title">unitPrice'</span>)</span> &lt;=&gt; it.b.getProperty<span class="container">('<span class="title">unitPrice'</span>)</span></span>
}).map()</code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#transform/order">Gremlin order step</a></li>
<li><a href="http://gremlindocs.com/#transform/key">Gremlin property access</a></li>
<li><a href="http://groovy.codehaus.org/Operators#Operators-TableofOperators">Groovy spaceship operator</a></li>
<li><a href="http://gremlindocs.com/#transform/map">Gremlin map step</a></li>
</ul>
<h3 id='ordering/order-by-value-descending'>Order by value descending</h3 id='ordering/order-by-value-descending'>
<p>This sample shows how to query all products ordered by descending unit price.</p>
<h4>SQL</h4>
<pre><code class="lang-sql">  <span class="operator"><span class="keyword">SELECT</span> *
    <span class="keyword">FROM</span> Products
<span class="keyword">ORDER</span> <span class="keyword">BY</span> UnitPrice <span class="keyword">DESC</span></code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','product').order<span class="container">({
  <span class="title">it</span>.<span class="title">b</span>.<span class="title">getProperty</span>('<span class="title">unitPrice'</span>)</span> &lt;=&gt; it.a.getProperty<span class="container">('<span class="title">unitPrice'</span>)</span></span>
}).map()</code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#transform/order">Gremlin order step</a></li>
<li><a href="http://gremlindocs.com/#transform/key">Gremlin property access</a></li>
<li><a href="http://gremlindocs.com/#transform/map">Gremlin map step</a></li>
<li><a href="http://groovy.codehaus.org/Operators#Operators-TableofOperators">Groovy spaceship operator</a></li>
</ul>
<h2 id='paging'>Paging</h2 id='paging'>
<h3 id='paging/limit-number-of-results'>Limit number of results</h3 id='paging/limit-number-of-results'>
<p>This sample shows how to query the first 5 products ordered by unit price.</p>
<h4>SQL</h4>
<pre><code class="lang-sql">  <span class="operator"><span class="keyword">SELECT</span> TOP (<span class="number">5</span>) *
    <span class="keyword">FROM</span> Products
<span class="keyword">ORDER</span> <span class="keyword">BY</span> UnitPrice</code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','product').order<span class="container">({
  <span class="title">it</span>.<span class="title">b</span>.<span class="title">getProperty</span>('<span class="title">unitPrice'</span>)</span> &lt;=&gt; it.a.getProperty<span class="container">('<span class="title">unitPrice'</span>)</span></span>
})[<span class="number">0.</span>.&lt;<span class="number">5</span>].map()</code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#transform/order">Gremlin order step</a></li>
<li><a href="http://gremlindocs.com/#transform/key">Gremlin property access</a></li>
<li><a href="http://gremlindocs.com/#filter/i-j">Gremlin range filter</a></li>
<li><a href="http://gremlindocs.com/#transform/map">Gremlin map step</a></li>
<li><a href="http://groovy.codehaus.org/Operators#Operators-TableofOperators">Groovy spaceship operator</a></li>
</ul>
<h3 id='paging/paged-result-set'>Paged result set</h3 id='paging/paged-result-set'>
<p>This sample shows how to query the next 5 products (page 2) ordered by unit price.</p>
<h4>SQL</h4>
<pre><code class="lang-sql">   <span class="operator"><span class="keyword">SELECT</span> Products.*
     <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> ROW_NUMBER()
                    OVER (
                      <span class="keyword">ORDER</span> <span class="keyword">BY</span> UnitPrice) <span class="keyword">AS</span> [ROW_NUMBER],
                  ProductID
             <span class="keyword">FROM</span> Products) <span class="keyword">AS</span> SortedProducts
       <span class="keyword">INNER</span> <span class="keyword">JOIN</span> Products
               <span class="keyword">ON</span> Products.ProductID = SortedProducts.ProductID
    <span class="keyword">WHERE</span> [ROW_NUMBER] BETWEEN <span class="number">6</span> <span class="keyword">AND</span> <span class="number">10</span>
 <span class="keyword">ORDER</span> <span class="keyword">BY</span> [ROW_NUMBER]</code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','product').order<span class="container">({
  <span class="title">it</span>.<span class="title">b</span>.<span class="title">getProperty</span>('<span class="title">unitPrice'</span>)</span> &lt;=&gt; it.a.getProperty<span class="container">('<span class="title">unitPrice'</span>)</span></span>
})[<span class="number">5.</span>.&lt;<span class="number">10</span>].map()</code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#transform/order">Gremlin order step</a></li>
<li><a href="http://gremlindocs.com/#transform/key">Gremlin property access</a></li>
<li><a href="http://gremlindocs.com/#filter/i-j">Gremlin range filter</a></li>
<li><a href="http://gremlindocs.com/#transform/map">Gremlin map step</a></li>
<li><a href="http://groovy.codehaus.org/Operators#Operators-TableofOperators">Groovy spaceship operator</a></li>
</ul>
<h2 id='grouping'>Grouping</h2 id='grouping'>
<h3 id='grouping/group-by-value'>Group by value</h3 id='grouping/group-by-value'>
<p>This sample shows how to determine the most used unit price.</p>
<h4>SQL</h4>
<pre><code class="lang-sql">  <span class="operator"><span class="keyword">SELECT</span> TOP(<span class="number">1</span>) UnitPrice
    <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> Products.UnitPrice,
                 <span class="aggregate">COUNT</span>(*) <span class="keyword">AS</span> [<span class="aggregate">Count</span>]
            <span class="keyword">FROM</span> Products
        <span class="keyword">GROUP</span> <span class="keyword">BY</span> Products.UnitPrice) <span class="keyword">AS</span> T
<span class="keyword">ORDER</span> <span class="keyword">BY</span> [<span class="aggregate">Count</span>] <span class="keyword">DESC</span></code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','product').property<span class="container">('<span class="title">unitPrice'</span>)</span>.groupCount<span class="container">()</span>.cap<span class="container">()</span> \</span>
 .orderMap(<span class="type">T</span>.decr).next()</code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#side-effect/groupcount">Gremlin groupCount step</a></li>
<li><a href="http://gremlindocs.com/#transform/cap">Gremlin cap step</a></li>
<li><a href="http://gremlindocs.com/#transform/ordermap">Gremlin orderMap step</a></li>
<li><a href="http://gremlindocs.com/#methods/pipe-next">Gremlin next method</a></li>
</ul>
<h2 id='joining'>Joining</h2 id='joining'>
<h3 id='joining/inner-join'>Inner join</h3 id='joining/inner-join'>
<p>This sample shows how to query all products from a specific category.</p>
<h4>SQL</h4>
<pre><code class="lang-sql">    <span class="operator"><span class="keyword">SELECT</span> Products.*
      <span class="keyword">FROM</span> Products
<span class="keyword">INNER</span> <span class="keyword">JOIN</span> Categories
        <span class="keyword">ON</span> Categories.CategoryID = Products.CategoryID
     <span class="keyword">WHERE</span> Categories.CategoryName = <span class="string">'Beverages'</span></code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy">g.V(<span class="attribute">'categoryName</span>',<span class="attribute">'Beverages</span>').<span class="keyword">in</span>(<span class="attribute">'inCategory</span>').<span class="keyword">map</span>()</code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#transform/in">Gremlin in step</a></li>
<li><a href="http://gremlindocs.com/#transform/map">Gremlin map step</a></li>
</ul>
<h3 id='joining/left-join'>Left join</h3 id='joining/left-join'>
<p>This sample shows how to count the number of orders for each customer.</p>
<h4>SQL</h4>
<pre><code class="lang-sql">    <span class="operator"><span class="keyword">SELECT</span> Customers.CustomerID, <span class="aggregate">COUNT</span>(Orders.OrderID)
      <span class="keyword">FROM</span> Customers
 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Orders
        <span class="keyword">ON</span> Orders.CustomerID = Customers.CustomerID
  <span class="keyword">GROUP</span> <span class="keyword">BY</span> Customers.CustomerID</code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','customer').transform<span class="container">({
  [ '<span class="title">customerId'</span> : <span class="title">it</span>.<span class="title">getProperty</span>('<span class="title">customerId'</span>)</span></span>
  ,<span class="string"> 'orders'</span>     : it.out('ordered').count() ]
})</code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#transform/transform">Gremlin transform step</a></li>
<li><a href="http://gremlindocs.com/#transform/key">Gremlin property access</a></li>
<li><a href="http://gremlindocs.com/#transform/out">Gremlin out step</a></li>
<li><a href="http://www.tinkerpop.com/docs/javadocs/gremlin/2.3.0/com/tinkerpop/gremlin/java/GremlinPipeline.html#count%28%29">Gremlin count</a></li>
</ul>
<h2 id='miscellaneous'>Miscellaneous</h2 id='miscellaneous'>
<h3 id='miscellaneous/concatenate'>Concatenate</h3 id='miscellaneous/concatenate'>
<p>This sample shows how to concatenate two result sets (customers whos company name starts with &#39;A&#39; and customers whos company name starts with &#39;E&#39;).</p>
<h4>SQL</h4>
<pre><code class="lang-sql"><span class="operator"><span class="keyword">SELECT</span> [customer].[CompanyName]
  <span class="keyword">FROM</span> [Customers] <span class="keyword">AS</span> [customer]
 <span class="keyword">WHERE</span> [customer].[CompanyName] <span class="keyword">LIKE</span> <span class="string">'A%'</span>
 <span class="keyword">UNION</span> <span class="keyword">ALL</span>
<span class="keyword">SELECT</span> [customer].[CompanyName]
  <span class="keyword">FROM</span> [Customers] <span class="keyword">AS</span> [customer]
 <span class="keyword">WHERE</span> [customer].[CompanyName] <span class="keyword">LIKE</span> <span class="string">'E%'</span></code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','customer').copySplit<span class="container">(
  <span class="title">_</span>()</span>.filter<span class="container">({ <span class="title">it</span>.<span class="title">getProperty</span>('<span class="title">companyName'</span>)</span>[0] == "<span class="type">A</span>" }),</span>
  _().filter({ it.getProperty('companyName')[<span class="number">0</span>] == <span class="string">"E"</span> })
).exhaustMerge().companyName</code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#branch/copysplit">Gremlin copySplit step</a></li>
<li><a href="http://gremlindocs.com/#filter/filter">Gremlin filter step</a></li>
<li><a href="http://gremlindocs.com/#transform/key">Gremlin property access</a></li>
<li><a href="http://gremlindocs.com/#branch/exhaustmerge">Gremlin exhaustMerge step</a></li>
</ul>
<h3 id='miscellaneous/create-update-and-delete'>Create, Update and Delete</h3 id='miscellaneous/create-update-and-delete'>
<p>This sample shows how to create new vertices and edges, how to update them and finally how to delete them.</p>
<h4>SQL</h4>
<pre><code class="lang-sql"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> [Categories] ([CategoryName], [Description])
     <span class="keyword">VALUES</span> (N<span class="string">'Merchandising'</span>, N<span class="string">'Cool products to promote Gremlin'</span>)

<span class="keyword">INSERT</span> <span class="keyword">INTO</span> [Products] ([ProductName], [CategoryID])
     <span class="keyword">SELECT</span> TOP (<span class="number">1</span>) N<span class="string">'Red Gremlin Jacket'</span>, [CategoryID]
       <span class="keyword">FROM</span> [Categories]
      <span class="keyword">WHERE</span> [CategoryName] = N<span class="string">'Merchandising'</span>

<span class="keyword">UPDATE</span> [Products]
   <span class="keyword">SET</span> [Products].[ProductName] = N<span class="string">'Green Gremlin Jacket'</span>
 <span class="keyword">WHERE</span> [Products].[ProductName] = N<span class="string">'Red Gremlin Jacket'</span>

<span class="keyword">DELETE</span> <span class="keyword">FROM</span> [Products]
 <span class="keyword">WHERE</span> [Products].[ProductName] = N<span class="string">'Green Gremlin Jacket'</span>

<span class="keyword">DELETE</span> <span class="keyword">FROM</span> [Categories]
 <span class="keyword">WHERE</span> [Categories].[CategoryName] = N<span class="string">'Merchandising'</span></code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy">c = g.addVertex([ <span class="comment">'type'         : 'category'</span>
                , <span class="comment">'categoryName' : 'Merchandising'</span>
                , <span class="comment">'description'  : 'Cool products to promote Gremlin'])</span>

p = g.addVertex([ <span class="comment">'type'        : 'product'</span>
                , <span class="comment">'productName' : 'Red Gremlin Jacket'])</span>

g.addEdge(p, c, <span class="comment">'inCategory')</span>

g.V().has(<span class="comment">'productName', 'Red Gremlin Jacket').sideEffect({</span>
  it.setProperty(<span class="comment">'productName', 'Green Gremlin Jacket')</span>
}).iterate()

p.remove()
g.V(<span class="comment">'categoryName', 'Merchandising').remove()</span></code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#methods/graph-addvertex">Gremlin addVertex method</a></li>
<li><a href="http://gremlindocs.com/#methods/graph-addedge">Gremlin addEdge method</a></li>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#filter/has">Gremlin has step</a></li>
<li><a href="http://gremlindocs.com/#side-effect/sideeffect">Gremlin sideEffect step</a></li>
<li><a href="http://gremlindocs.com/#methods/pipe-iterate">Gremlin iterate method</a></li>
<li><a href="http://gremlindocs.com/#methods/element-remove">Gremlin remove method</a></li>
</ul>
<h2 id='cte'>CTE</h2 id='cte'>
<h3 id='cte/recursive-query'>Recursive query</h3 id='cte/recursive-query'>
<p>This sample shows how to query all employees, their supervisors and their hierarchy level depending on where the employee is located in the supervisor chain.</p>
<h4>SQL</h4>
<pre><code class="lang-sql">WITH EmployeeHierarchy (EmployeeID,
                        LastName,
                        FirstName,
                        ReportsTo,
                        HierarchyLevel) AS
(
    <span class="operator"><span class="keyword">SELECT</span> EmployeeID
         , LastName
         , FirstName
         , ReportsTo
         , <span class="number">1</span> <span class="keyword">as</span> HierarchyLevel
      <span class="keyword">FROM</span> Employees
     <span class="keyword">WHERE</span> ReportsTo <span class="keyword">IS</span> <span class="keyword">NULL</span>

     <span class="keyword">UNION</span> <span class="keyword">ALL</span>

    <span class="keyword">SELECT</span> e.EmployeeID
         , e.LastName
         , e.FirstName
         , e.ReportsTo
         , eh.HierarchyLevel + <span class="number">1</span> <span class="keyword">AS</span> HierarchyLevel
      <span class="keyword">FROM</span> Employees e
<span class="keyword">INNER</span> <span class="keyword">JOIN</span> EmployeeHierarchy eh
        <span class="keyword">ON</span> e.ReportsTo = eh.EmployeeID
)
  <span class="keyword">SELECT</span> *
    <span class="keyword">FROM</span> EmployeeHierarchy
<span class="keyword">ORDER</span> <span class="keyword">BY</span> HierarchyLevel, LastName, FirstName</code></pre>
<h4>Gremlin (hierarchical)</h4>
<pre><code class="lang-groovy"><span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','employee').filter<span class="container">({ !<span class="title">it</span>.<span class="title">out</span>('<span class="title">reportsTo'</span>)</span>.hasNext<span class="container">()</span> }) \</span>
 .<span class="keyword">as</span>('employee').<span class="keyword">in</span>('reportsTo').loop('employee'){true}{true}.tree().cap().next()</code></pre>
<p>You can also produce the same tabular result that&#39;s produced by SQL.</p>
<h4>Gremlin (tabular)</h4>
<pre><code class="lang-groovy"><span class="title">r</span> = []; t = { e, l -&gt;
  [<span class="string"> 'employeeId'</span>     : e.id
  ,<span class="string"> 'lastname'</span>       : e.getProperty('lastName')
  ,<span class="string"> 'firstname'</span>      : e.getProperty('firstName')
  ,<span class="string"> 'reportsTo'</span>      : l &gt; <span class="number">1</span> ? e.out('reportsTo').next().id : null
  ,<span class="string"> 'hierarchyLevel'</span> : l ]
}; \
<span class="title">g</span>.<span class="type">V</span>('<span class="typedef"><span class="keyword">type</span>','employee').filter<span class="container">({ !<span class="title">it</span>.<span class="title">out</span>('<span class="title">reportsTo'</span>)</span>.hasNext<span class="container">()</span> }) \</span>
 .sideEffect({ r &lt;&lt; t(it, <span class="number">1</span>) }).<span class="keyword">as</span>('boss').<span class="keyword">in</span>('reportsTo').loop('boss', {
   r &lt;&lt; t(it.object, it.loops)
   true
 }).iterate(); r</code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#filter/filter">Gremlin filter step</a></li>
<li><a href="http://gremlindocs.com/#transform/out">Gremlin out step</a></li>
<li><a href="http://gremlindocs.com/#side-effect/sideeffect">Gremlin sideEffect step</a></li>
<li><a href="http://gremlindocs.com/#side-effect/as">Gremlin as step</a></li>
<li><a href="http://gremlindocs.com/#transform/in">Gremlin in step</a></li>
<li><a href="http://gremlindocs.com/#branch/loop">Gremlin loop step</a></li>
<li><a href="http://gremlindocs.com/#methods/pipe-iterate">Gremlin iterate</a></li>
<li><a href="http://groovy.codehaus.org/groovy-jdk/java/util/Collection.html#leftShift%28T%29">Groovy left shift</a></li>
</ul>
<h2 id='complex'>Complex</h2 id='complex'>
<h3 id='complex/pivots'>Pivots</h3 id='complex/pivots'>
<p>This sample shows how to determine the average total order value per month for each customer.</p>
<h4>SQL</h4>
<pre><code class="lang-sql">    <span class="operator"><span class="keyword">SELECT</span> Customers.CompanyName,
           COALESCE([<span class="number">1</span>], <span class="number">0</span>)  <span class="keyword">AS</span> [Jan],
           COALESCE([<span class="number">2</span>], <span class="number">0</span>)  <span class="keyword">AS</span> [Feb],
           COALESCE([<span class="number">3</span>], <span class="number">0</span>)  <span class="keyword">AS</span> [Mar],
           COALESCE([<span class="number">4</span>], <span class="number">0</span>)  <span class="keyword">AS</span> [Apr],
           COALESCE([<span class="number">5</span>], <span class="number">0</span>)  <span class="keyword">AS</span> [May],
           COALESCE([<span class="number">6</span>], <span class="number">0</span>)  <span class="keyword">AS</span> [Jun],
           COALESCE([<span class="number">7</span>], <span class="number">0</span>)  <span class="keyword">AS</span> [Jul],
           COALESCE([<span class="number">8</span>], <span class="number">0</span>)  <span class="keyword">AS</span> [Aug],
           COALESCE([<span class="number">9</span>], <span class="number">0</span>)  <span class="keyword">AS</span> [Sep],
           COALESCE([<span class="number">10</span>], <span class="number">0</span>) <span class="keyword">AS</span> [Oct],
           COALESCE([<span class="number">11</span>], <span class="number">0</span>) <span class="keyword">AS</span> [Nov],
           COALESCE([<span class="number">12</span>], <span class="number">0</span>) <span class="keyword">AS</span> [<span class="keyword">Dec</span>]
      <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> Orders.CustomerID,
                   <span class="keyword">MONTH</span>(Orders.OrderDate)                                   <span class="keyword">AS</span> [<span class="keyword">Month</span>],
                   <span class="aggregate">SUM</span>([<span class="keyword">Order</span> Details].UnitPrice * [<span class="keyword">Order</span> Details].Quantity) <span class="keyword">AS</span> Total
              <span class="keyword">FROM</span> Orders
        <span class="keyword">INNER</span> <span class="keyword">JOIN</span> [<span class="keyword">Order</span> Details]
                <span class="keyword">ON</span> [<span class="keyword">Order</span> Details].OrderID = Orders.OrderID
          <span class="keyword">GROUP</span> <span class="keyword">BY</span> Orders.CustomerID,
                   <span class="keyword">MONTH</span>(Orders.OrderDate)) o
     PIVOT (<span class="aggregate">AVG</span>(Total) <span class="keyword">FOR</span> [<span class="keyword">Month</span>] <span class="keyword">IN</span> ([<span class="number">1</span>],
                                       [<span class="number">2</span>],
                                       [<span class="number">3</span>],
                                       [<span class="number">4</span>],
                                       [<span class="number">5</span>],
                                       [<span class="number">6</span>],
                                       [<span class="number">7</span>],
                                       [<span class="number">8</span>],
                                       [<span class="number">9</span>],
                                       [<span class="number">10</span>],
                                       [<span class="number">11</span>],
                                       [<span class="number">12</span>])) <span class="keyword">AS</span> [Pivot]
<span class="keyword">INNER</span> <span class="keyword">JOIN</span> Customers
        <span class="keyword">ON</span> Customers.CustomerID = [Pivot].CustomerID
  <span class="keyword">ORDER</span> <span class="keyword">BY</span> Customers.CompanyName</code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy">monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']; \
rowTotal   = { <span class="keyword">it</span>.getProperty('unitPrice') * <span class="keyword">it</span>.getProperty('quantity') }; \
g.V('type','customer') \
 .order({ <span class="keyword">it</span>.a.getProperty('customerId') &lt;=&gt; <span class="keyword">it</span>.b.getProperty('customerId') }) \
 .filter({ <span class="keyword">it</span>.out('ordered').hasNext() }).transform({
   m = [:]
   t = ['customerId':<span class="keyword">it</span>.getProperty('customerId')]
   <span class="keyword">it</span>.out('ordered').groupBy(m,
     {new Date(<span class="keyword">it</span>.getProperty('orderDate')).getMonth()},
     {<span class="keyword">it</span>.out('<span class="keyword">contains</span>').transform(rowTotal).sum()}).iterate()
   (<span class="number">0.</span><span class="number">.11</span>).each({
     t.<span class="keyword">put</span>(monthNames[<span class="keyword">it</span>], m.containsKey(<span class="keyword">it</span>) ? m[<span class="keyword">it</span>].mean().<span class="command">round</span>(<span class="number">2</span>) : <span class="number">0</span>f)
   })
   t
})</code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#transform/order">Gremlin order step</a></li>
<li><a href="http://gremlindocs.com/#transform/key">Gremlin property access</a></li>
<li><a href="http://gremlindocs.com/#filter/filter">Gremlin filter step</a></li>
<li><a href="http://gremlindocs.com/#transform/out">Gremlin out step</a></li>
<li><a href="http://gremlindocs.com/#transform/transform">Gremlin transform step</a></li>
<li><a href="http://gremlindocs.com/#side-effect/groupby">Gremlin groupBy step</a></li>
</ul>
<h3 id='complex/recommendation'>Recommendation</h3 id='complex/recommendation'>
<p>This sample shows how to recommend 5 products for a specific customer. The products are chosen as follows:</p>
<ul>
<li>determine what the customer has already ordered</li>
<li>determine who else ordered the same products</li>
<li>determine what others also ordered</li>
<li>determine products which were not already ordered by the initial customer, but ordered by the others</li>
<li>rank products by occurence in other orders</li>
</ul>
<h4>SQL</h4>
<pre><code class="lang-sql">  <span class="operator"><span class="keyword">SELECT</span> TOP (<span class="number">5</span>) [t14].[ProductName]
    <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="aggregate">COUNT</span>(*) <span class="keyword">AS</span> [<span class="keyword">value</span>],
                 [t13].[ProductName]
            <span class="keyword">FROM</span> [customers] <span class="keyword">AS</span> [t0]
     <span class="keyword">CROSS</span> APPLY (<span class="keyword">SELECT</span> [t9].[ProductName]
                    <span class="keyword">FROM</span> [orders] <span class="keyword">AS</span> [t1]
              <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> [<span class="keyword">order</span> details] <span class="keyword">AS</span> [t2]
              <span class="keyword">INNER</span> <span class="keyword">JOIN</span> [products] <span class="keyword">AS</span> [t3]
                      <span class="keyword">ON</span> [t3].[ProductID] = [t2].[ProductID]
              <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> [<span class="keyword">order</span> details] <span class="keyword">AS</span> [t4]
              <span class="keyword">INNER</span> <span class="keyword">JOIN</span> [orders] <span class="keyword">AS</span> [t5]
                      <span class="keyword">ON</span> [t5].[OrderID] = [t4].[OrderID]
               <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> [customers] <span class="keyword">AS</span> [t6]
                      <span class="keyword">ON</span> [t6].[CustomerID] = [t5].[CustomerID]
              <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> ([orders] <span class="keyword">AS</span> [t7]
                          <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> [<span class="keyword">order</span> details] <span class="keyword">AS</span> [t8]
                          <span class="keyword">INNER</span> <span class="keyword">JOIN</span> [products] <span class="keyword">AS</span> [t9]
                                  <span class="keyword">ON</span> [t9].[ProductID] = [t8].[ProductID])
                   <span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="keyword">NULL</span> <span class="keyword">AS</span> [EMPTY]
                                      <span class="keyword">FROM</span> [orders] <span class="keyword">AS</span> [t10]
                                <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> [<span class="keyword">order</span> details] <span class="keyword">AS</span> [t11]
                                <span class="keyword">INNER</span> <span class="keyword">JOIN</span> [products] <span class="keyword">AS</span> [t12]
                                        <span class="keyword">ON</span> [t12].[ProductID] = [t11].[ProductID]
                                     <span class="keyword">WHERE</span> [t9].[ProductID] = [t12].[ProductID]
                                       <span class="keyword">AND</span> [t10].[CustomerID] = [t0].[CustomerID]
                                       <span class="keyword">AND</span> [t11].[OrderID] = [t10].[OrderID])
                     <span class="keyword">AND</span> [t6].[CustomerID] &lt;&gt; [t0].[CustomerID]
                     <span class="keyword">AND</span> [t1].[CustomerID] = [t0].[CustomerID]
                     <span class="keyword">AND</span> [t2].[OrderID] = [t1].[OrderID]
                     <span class="keyword">AND</span> [t4].[ProductID] = [t3].[ProductID]
                     <span class="keyword">AND</span> [t7].[CustomerID] = [t6].[CustomerID]
                     <span class="keyword">AND</span> [t8].[OrderID] = [t7].[OrderID]) <span class="keyword">AS</span> [t13]
           <span class="keyword">WHERE</span> [t0].[CustomerID] = N<span class="string">'ALFKI'</span>
        <span class="keyword">GROUP</span> <span class="keyword">BY</span> [t13].[ProductName]) <span class="keyword">AS</span> [t14]
<span class="keyword">ORDER</span> <span class="keyword">BY</span> [t14].[<span class="keyword">value</span>] <span class="keyword">DESC</span></code></pre>
<h4>Gremlin</h4>
<pre><code class="lang-groovy">g.V(<span class="attribute">'customerId</span>',<span class="attribute">'ALFKI</span>').as(<span class="attribute">'customer</span>')                      \
 .<span class="keyword">out</span>(<span class="attribute">'ordered</span>').<span class="keyword">out</span>(<span class="attribute">'contains</span>').<span class="keyword">out</span>(<span class="attribute">'is</span>').as(<span class="attribute">'products</span>')     \
 .<span class="keyword">in</span>(<span class="attribute">'is</span>').<span class="keyword">in</span>(<span class="attribute">'contains</span>').<span class="keyword">in</span>(<span class="attribute">'ordered</span>').except(<span class="attribute">'customer</span>')    \
 .<span class="keyword">out</span>(<span class="attribute">'ordered</span>').<span class="keyword">out</span>(<span class="attribute">'contains</span>').<span class="keyword">out</span>(<span class="attribute">'is</span>').except(<span class="attribute">'products</span>') \
 .groupCount().cap().orderMap(T.decr)[<span class="number">0.</span>.&lt;<span class="number">5</span>].productName</code></pre>
<p><strong>References:</strong></p>
<ul>
<li><a href="http://gremlindocs.com/#transform/v">Gremlin vertex iterator</a></li>
<li><a href="http://gremlindocs.com/#side-effect/as">Gremlin as step</a></li>
<li><a href="http://gremlindocs.com/#transform/out">Gremlin out step</a></li>
<li><a href="http://gremlindocs.com/#transform/in">Gremlin in step</a></li>
<li><a href="http://gremlindocs.com/#filter/except">Gremlin except step</a></li>
<li><a href="http://gremlindocs.com/#side-effect/groupcount">Gremlin groupCount step</a></li>
<li><a href="http://gremlindocs.com/#transform/cap">Gremlin cap step</a></li>
<li><a href="http://gremlindocs.com/#transform/ordermap">Gremlin orderMap step</a></li>
<li><a href="http://gremlindocs.com/#filter/i-j">Gremlin range filter</a></li>
</ul>

  </div>
</div>
</body>
</html>